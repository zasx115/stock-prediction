# ============================================
# íŒŒì¼ëª…: .github/workflows/hybrid_weekly.yml
# ì„¤ëª…: Hybrid ì „ëžµ ì£¼ê°„ ìžë™ ì‹¤í–‰
# 
# ìŠ¤ì¼€ì¤„: ë§¤ì£¼ í™”ìš”ì¼ 06:55 UTC (í•œêµ­ì‹œê°„ 15:55)
# ëª¨ë©˜í…€(06:45) 10ë¶„ í›„ ì‹¤í–‰
# ============================================

name: Hybrid Weekly Signal

on:
  # ë§¤ì£¼ í™”ìš”ì¼ 06:55 UTC ì‹¤í–‰ (ëª¨ë©˜í…€ 10ë¶„ í›„)
  schedule:
    - cron: '55 6 * * 2'
  
  # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥
  workflow_dispatch:

jobs:
  hybrid-signal:
    runs-on: ubuntu-latest
    
    steps:
      # 1. ì½”ë“œ ì²´í¬ì•„ì›ƒ
      - name: Checkout repository
        uses: actions/checkout@v4
      
      # 2. Python ì„¤ì¹˜
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      # 3. ì˜ì¡´ì„± ì„¤ì¹˜
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pandas numpy yfinance requests xgboost scikit-learn gspread oauth2client
      
      # 4. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
      - name: Setup environment
        env:
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          GOOGLE_CREDENTIALS: ${{ secrets.GOOGLE_CREDENTIALS }}
        run: |
          echo "TELEGRAM_TOKEN=$TELEGRAM_TOKEN" >> $GITHUB_ENV
          echo "TELEGRAM_CHAT_ID=$TELEGRAM_CHAT_ID" >> $GITHUB_ENV
          echo "$GOOGLE_CREDENTIALS" > /tmp/credentials.json
          echo "GOOGLE_CREDENTIALS_PATH=/tmp/credentials.json" >> $GITHUB_ENV
      
      # 5. Hybrid ì „ëžµ ì‹¤í–‰
      - name: Run Hybrid Strategy
        working-directory: ./src
        env:
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          GOOGLE_CREDENTIALS_PATH: /tmp/credentials.json
        run: |
          python -c "
          from hybrid_trading import run_hybrid_weekly
          from config import INITIAL_CAPITAL
          
          print('ðŸ¤– Hybrid ì „ëžµ ì‹¤í–‰ ì‹œìž‘...')
          result = run_hybrid_weekly(total_capital=INITIAL_CAPITAL)
          print('âœ… ì™„ë£Œ!')
          "