# ============================================
# íŒŒì¼ëª…: .github/workflows/hybrid_daily.yml
# ì„¤ëª…: Hybrid ì „ëžµ ë§¤ì¼ ì‹¤í–‰ (ì›”,ìˆ˜,ëª©,ê¸ˆ)
# 
# ê¸°ëŠ¥:
# - ì†ì ˆ ì²´í¬
# - ì¼ì¼ ê°€ì¹˜ ê¸°ë¡
# - ì„±ê³¼ ì—…ë°ì´íŠ¸
# ============================================

name: Hybrid Daily Check

on:
  # ì›”,ìˆ˜,ëª©,ê¸ˆ 06:55 UTC (í•œêµ­ì‹œê°„ 15:55)
  schedule:
    - cron: '55 6 * * 1,3,4,5'
  
  # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥
  workflow_dispatch:

jobs:
  hybrid-daily:
    runs-on: ubuntu-latest
    
    steps:
      # 1. ì½”ë“œ ì²´í¬ì•„ì›ƒ
      - name: Checkout repository
        uses: actions/checkout@v4
      
      # 2. Python ì„¤ì¹˜
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      # 3. ì˜ì¡´ì„± ì„¤ì¹˜
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pandas numpy yfinance requests gspread oauth2client python-dotenv lxml
      
      # 4. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
      - name: Setup environment
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          GOOGLE_CREDENTIALS: ${{ secrets.GOOGLE_CREDENTIALS }}
        run: |
          echo "TELEGRAM_BOT_TOKEN=$TELEGRAM_BOT_TOKEN" >> $GITHUB_ENV
          echo "TELEGRAM_CHAT_ID=$TELEGRAM_CHAT_ID" >> $GITHUB_ENV
      
      # 5. Hybrid Daily ì‹¤í–‰
      - name: Run Hybrid Daily
        working-directory: ./src
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          GOOGLE_CREDENTIALS: ${{ secrets.GOOGLE_CREDENTIALS }}
        run: |
          python -c "
          from hybrid_trading import run_hybrid_daily
          from config import INITIAL_CAPITAL
          
          print('ðŸ¤– Hybrid Daily ì‹¤í–‰ ì‹œìž‘...')
          run_hybrid_daily(total_capital=INITIAL_CAPITAL)
          print('âœ… ì™„ë£Œ!')
          " 